# Mini Tokyo 3D TE ユーザーガイド

English version is available [here](USER_GUIDE-en.md).

## Mini Tokyo 3D 概要

![Screenshot](images/screenshot1.jpg)

Mini Tokyo 3D は東京の公共交通のリアルタイム3Dマップです。今、実際に動いている列車や発着している旅客機をリアルな3Dマップ上に滑らかなアニメーションで表現します。これは、現実世界とそっくりな双子をデジタルの世界に表現した「デジタルツイン」です。

ユーザーは自由に3Dマップ上を動き回り、見たいところにズームインして東京の「今」を知ることができます。路線図として乗り換えルートを調べる、出かける前に目的地の街と天気を下調べする、列車を自動追跡して沿線の様子をただひたすら眺める、終電に逃さないためにダッシュすべきかどうか列車の現在位置から判断するなど、さまざまな使い方ができます。

Mini Tokyo 3D は PC、スマートフォン、タブレット、セットトップボックスなど、デバイスを問わず Web ブラウザさえあれば利用できる Web アプリケーションです。下記の URL からアクセスしてください。

[https://nagix.github.io/mini-tokyo-3d-toei/](https://nagix.github.io/mini-tokyo-3d-toei/)

Mini Tokyo 3D の特徴は次の通りです。

### 全てがリアルタイム

<img src="images/day-night.jpg" width="640">

現実の時刻表、さらにはリアルタイムの遅延情報に従って運行する列車や旅客機を上空の好きな視点から観覧できます。東京の日の出・日の入り時刻に合わせて景色の明るさが変わり、夕焼けも見られます。また、リアルタイムの気象情報を基にした降水アニメーションが表示されるため、よりリアルな風景を楽しめます。

### 鉄道路線図の見やすさをそのままに

<img src="images/transit.jpg" width="328">

路線図や案内で使われているものと同じラインカラーを使用し、地図の縮尺に合わせて各路線を適切な間隔で配置してルートを見やすい形で表現します。駅名が異なっていても乗り換え駅である場合には駅間の接続を表示して、スムーズな乗り換えをサポートします。列車の形はあえてシンプルな単色の直方体にして、シンボル性を高めています。

### 操作性とパフォーマンス

<img src="images/performance.jpg" width="537">

ラッシュ時には1,100を超える列車が同時に走りますが、最適化されたデータ構造と計算処理により、スマートフォンでも非常にスムーズな運行アニメーションを実現。視点移動や地上・地下表示の切り替え、列車・旅客機のフェードイン・アウトなど、60フレーム/秒のスムーズなアニメーションを随所に利用しています。

### 4ヶ国語対応

<img src="images/multilanguage.jpg" width="219">

日本語以外に、訪日観光客の多い英語・中国語・韓国語に対応。ユーザーインターフェース表示だけではなく、路線名、駅名、列車種別、空港名、航空会社名なども多言語化。ユーザーインターフェース表示に限り、タイ語・ネパール語にも対応しています。

### 現実に限りなく近づけた列車運行と表示

<img src="images/reality.jpg" width="604">

実際の列車と同じ動きになるように、乗車しながら列車の起動加速度や最高速度の微調整を繰り返しました。地図の縮尺に従って実際の列車長に見合った車両編成になるように切り替わり、一定以上の縮尺だとリアルタイムデータから得た実際の車両数を表示します。地上を走る列車の地下トンネル部分、地下鉄の地上走行区間も完全に再現しています。

**[2019年12月16日更新]** 列車長に見合った車両の表示は、既存特許に抵触する可能性がありましたので、機能を無効化しています。

### 地上・地下の表示切り替え

<img src="images/shinjuku-overground.jpg" width="300"> <img src="images/shinjuku-underground.jpg" width="300">

東京の鉄道ネットワークは世界有数の複雑度。地上と地下の路線網を切り替えて表示することで見やすさを追求するとともに、地下鉄路線の現実には見えない列車の運行をわかりやすく表現します。

## 画面・操作説明

### 画面の説明

<img src="images/screen.jpg" width="660">

1. **時刻表示**: [時刻表示](#%E6%99%82%E5%88%BB%E8%A1%A8%E7%A4%BA)をご覧ください
2. **検索ボタン**: [駅名検索](#%E9%A7%85%E5%90%8D%E6%A4%9C%E7%B4%A2)をご覧ください 
3. **ナビゲーションボタン**: [地図の拡大・縮小](#%E5%9C%B0%E5%9B%B3%E3%81%AE%E6%8B%A1%E5%A4%A7%E7%B8%AE%E5%B0%8F)、[地図の回転と傾きの変更](#%E5%9C%B0%E5%9B%B3%E3%81%AE%E5%9B%9E%E8%BB%A2%E3%81%A8%E5%82%BE%E3%81%8D%E3%81%AE%E5%A4%89%E6%9B%B4)をご覧ください
4. **表示モード切り替えボタン**: [表示モード](#%E8%A1%A8%E7%A4%BA%E3%83%A2%E3%83%BC%E3%83%89)をご覧ください
5. **アプリ情報ボタン**: [アプリ情報の表示](#%E3%82%A2%E3%83%97%E3%83%AA%E6%83%85%E5%A0%B1%E3%81%AE%E8%A1%A8%E7%A4%BA)をご覧ください

### 地図のスクロール

<img src="images/pan.jpg" width="244">

マウスドラッグまたは画面のスワイプで地図をスクロールして場所を移動することができます。また、キーボードの方向キーでも地図をスクロールすることができます。

### 地図の拡大・縮小

<img src="images/zoom.jpg" width="244"> <img src="images/zoom-icon.jpg" width="50" align="top">

「＋」「−」アイコンボタンをクリックまたはタップすると、地図を拡大・縮小することができます。また、マウスホイールの回転または画面のピンチイン・アウトで地図を拡大・縮小することができます。

さらに、キーボードの「＝」「−」キーを押すことでも地図を拡大・縮小することができます。マウスのダブルクリックまたはダブルタップで地図を拡大することもできます。

キーボードの Shift キーを押しながらマウスをドラッグして画面上の矩形を選択することで、対象範囲を拡大することができます。

### 地図の回転と傾きの変更

<img src="images/rotate-tilt.jpg" width="244"> <img src="images/compass-icon.jpg" width="50" align="top">

コンパスアイコンは、地図の向きを表しています。コンパスアイコンボタンを押してドラッグまたはスワイプすると、左右方向の動きで地図の回転、上下方向の動きで地図の傾きを変更することができます。また、マウスの右ボタンを押してドラッグ、またはキーボードの Ctrl キーを押しながらマウスの左ボタンを押してドラッグすることで地図の回転と傾きを変更することができます。

さらに、キーボードの Shift キーを押しながら方向キーを押すことでも地図の回転と傾きを変更することができます。画面のピンチ操作で地図を回転することもできます。

コンパスアイコンボタンをクリックまたはタップすると、地図が真北を向くように回転します。

### 列車・旅客機の追跡

列車や旅客機をクリックまたはタップすると、[追跡モード](#%E8%BF%BD%E8%B7%A1%E3%83%A2%E3%83%BC%E3%83%89)がオンに切り替わり、列車や旅客機の動きに追随して画面が自動的に移動します。追跡モードには「ヘリコプター追跡モード」と「斜め後方追跡モード」の2種類があり、お好みの追跡モードで沿線の風景を楽しむことができます。追跡モードがオンの状態では、地図のスクロール・回転操作は無効になります（拡大・縮小、傾きの変更は可能です）。列車や旅客機が存在しない地図上をクリックすると、追跡モードがオフに切り替わります。

追跡モードの詳細については[こちら](#%E8%BF%BD%E8%B7%A1%E3%83%A2%E3%83%BC%E3%83%89)をご覧ください。

### 時刻表示

<img src="images/clock.jpg" width="141">

[リアルタイムモード](#%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%A2%E3%83%BC%E3%83%89)がオンの状態では、画面左上に現在時刻が表示されます。常に日本時間が表示されるため、海外からのアクセス時に便利です。

### ズームインによる車両編成の表示

<img src="images/train-short.jpg" width="200"> <img src="images/train-long.jpg" width="600"> 

地図を拡大していくと、実際の車両編成に基づいた数の連結された車両が表示されます。例えば山手線は11両、東海道線は列車により11両または15両です。車両数はリアルタイムデータから取得しています。

**[2019年12月16日更新]** 車両編成に基づいた車両の表示は、既存特許に抵触する可能性がありましたので、機能を無効化しています。

### 遅延列車の表示

<img src="images/delay-marker.jpg" width="185">

[リアルタイムモード](#%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%A2%E3%83%BC%E3%83%89)がオンの状態では、1分以上遅延している列車には周囲にオレンジ色の球が表示されます。地図上のどの区間で遅れがあるかが一目瞭然です。

### 列車・旅客機の詳細情報の表示

<img src="images/train-details.jpg" width="216"> <img src="images/flight-details.jpg" width="216">

[リアルタイムモード](#%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%A2%E3%83%BC%E3%83%89)がオンの状態で、列車や旅客機にマウスポインタを合わせたり、タップをすると列車や旅客機の詳細情報が表示されます。列車の詳細情報は、路線名、列車種別、行先、列車番号、前駅または停車駅と発車時刻、次駅と到着時刻、遅延時間、運行情報を含みます。旅客機の詳細情報は、航空会社名、便名、出発地または到着地、状況、出発時刻または到着時刻、コードシェアを含みます。列車の遅延もしくは旅客機のスケジュール変更がある場合は、変更部分がオレンジ色でハイライトされます。

### 駅名検索

<img src="images/station-search.jpg" width="260">

検索アイコンボタンをクリックまたはタップすると、検索ウインドウが現れてテキスト入力が可能になります。駅名を入力して Enter キーを押すか、検索アイコンボタンをクリックまたはタップすると、マップ上の対象の駅に移動します。駅名の一部を入力すると候補の一覧が表示されるため、その中から選択して入力を補完することもできます。日本語・韓国語・中国語の環境では、英語名での検索も可能です。

### アプリ情報の表示

<img src="images/info-icon.jpg" width="355">

情報アイコンボタンをクリックまたはタップすると、アプリおよびデータの情報が表示されます。静的データ・動的データの最終更新日時も表示されます。

## 表示モード

### フルスクリーンモード

<img src="images/fullscreen-icon.jpg" width="50">

画面拡大・縮小アイコンボタンをクリックまたはタップすると、フルスクリーンモードのオン・オフを切り替えることができます。

フルスクリーンモードがオンの状態では、ボタンをクリック／タップする以外に、Esc キーを押すことでフルスクリーンモードを解除できます。

### 地下モード

<img src="images/underground.jpg" width="662"> <img src="images/eye-icon.jpg" width="50" align="top">

眼アイコンボタンをクリックまたはタップすると、地下モードのオン・オフを切り替えることができます（オンの状態でアイコンは水色で表示されます）。

地下モードがオンの状態では、地図が暗転して地上の路線や駅、列車や航空機が半透明になる一方で、地下の路線、駅、列車が明るく表示されます。

地下モードがオフの状態では、地図が通常表示に戻って地上の路線や駅、列車や航空機が明るく表示され、地下の路線、駅、列車は半透明になります。

このほか、地下モードがオフの状態で地下の列車をクリックまたはタップしたり、地下モードがオンの状態で地上の列車をクリックまたはタップしたりするとモードが切り替わります。また、追跡中の列車が地上から地下に入ったり、地下から地上に出るときもモードが自動的に切り替わります。

### 追跡モード

<img src="images/helicopter-tracking.jpg" width="244"> <img src="images/helicopter-icon.jpg" width="50" align="top"> <img src="images/rear-tracking.jpg" width="244"> <img src="images/train-icon.jpg" width="50" align="top">

列車や旅客機をクリックまたはタップすると、追跡モードがオンに切り替わり、列車や旅客機の動きに追随して画面が自動的に移動します（オンの状態でアイコンは水色で表示されます）。列車や旅客機が存在しない地図上をクリックすると、追跡モードがオフに切り替わります。

ヘリコプターアイコンは「ヘリコプター追跡モード」を示しており、対象の列車や旅客機を中心に360度旋回を行います。列車アイコンは「斜め後方追跡モード」を示しており、対象の列車や旅客機の斜め後方から進行方向を見て追跡します。アイコンボタンをクリックまたはタップすると「ヘリコプター追跡モード」と「斜め後方追跡モード」が交互に切り替わります。

### リアルタイムモード

<img src="images/clock-icon.jpg" width="50">

時計アイコンボタンをクリックまたはタップすると、リアルタイムモードのオン・オフを切り替えることができます（オンの状態でアイコンは水色で表示されます）。

リアルタイムモードがオンの状態では、列車や航空機は現在時刻の実際の運行に合わせて地図上に表示されます。リアルタイム情報を利用しているため、列車の遅延や航空機のスケジュールの変更がある場合にはそれに合わせて地図上の位置が変わります。

リアルタイムモードがオフの状態では、各路線を往復する列車の運行を、まるで鉄道模型の動きを見るように楽しむことができます。

### 降水表示

<img src="images/weather.jpg" width="580"> <img src="images/weather-icon.jpg" width="50" align="top">

雨雲アイコンボタンをクリックまたはタップすると、降水アニメーションの表示のオン・オフを切り替えることができます（オンの状態でアイコンは水色で表示されます）。

リアルタイムの気象情報を基に、1kmメッシュ単位で8段階の降水強度を 3D アニメーションで表示します。

## データについて

本アプリケーションは次のデータを利用しています。

- [公共交通オープンデータセンター](https://www.odpt.org)
- [OpenStreetMap](https://www.openstreetmap.org)
- [気象庁降水ナウキャスト](https://www.jma.go.jp/jp/radnowc/)

本アプリケーションが利用する公共交通データは、公共交通オープンデータセンターにおいて提供されるものです。公共交通事業者により提供されたデータを元にしていますが、必ずしも正確・完全なものとは限りません。本アプリケーションの表示内容について、公共交通事業者への直接の問合せは行わないでください。

## 対応ブラウザ

次のブラウザで動作を確認しています。推奨は Chrome です。Internet Explorer には非対応です。

- Chrome 79 (Mac OS, Windows)
- FireFox 71 (Mac OS, Windows, iOS)
- Safari 13 (Mac OS, iOS)
- Edge 44 (Windows)

## 開発情報

本アプリケーションのソースコードは [GitHub リポジトリ](https://github.com/nagix/mini-tokyo-3d-toei) にて公開されています。開発の経緯は [Mini Tokyo 3D 開発日誌](https://togetter.com/li/1413307) にまとめています。

## 問い合わせ先

本アプリケーションに関するお問い合わせは、以下のメールアドレスにお願いします。

mini-tokyo-3d@nagi-p.com

